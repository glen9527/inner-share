<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 7.8 (457453)"/><meta name="altitude" content="54.34437942504883"/><meta name="author" content="all_register@163.com"/><meta name="created" content="2019-02-18 06:16:58 +0000"/><meta name="latitude" content="39.98223364670062"/><meta name="longitude" content="116.3211398545206"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2019-03-15 02:20:32 +0000"/><title>Android 用户行为数据采集埋点方案</title></head><body><div><span style="font-size: 18px;"><span style="font-size: 18px; font-weight: bold;">问题：</span></span></div><ol><li><div><span style="font-size: 14px;">我们有很多 ListView/ViewPager 是给 convertView 直接设置的监听器，所以 Hook onItemClick 方法没有作用，如果hook onclick 方法，没法区分位置</span></div></li><li><div>使用 AOP 针对点击事件，会多一次递归，效率较低；针对页面生命周期事件，AOP 和 BaseActivity 实现一样，但是在 Base 里更容易统计关联性(如统计页面停留时长，设计 resume 和 stop 两个过程，AOP 就很不好实现，但是 Base 可以很轻松实现)，所以目前使用了原声拦截的方式</div></li><li><div>viewId 确定 - - 所属页面/viewTree 路径+viewGroup 第几个子元素</div></li><li><div>Fragment 事件从 activity 中分离</div></li><li><div>弹窗上的事件采集不到</div></li><li><div>ListView header、footer上的事件还没搞定</div></li><li><div>把三个单独的，非继承自 BaseActionBarActivity 的 Activity 统一进行管理，采集生命周期事件</div></li></ol><div><br/></div><div><br/></div><div><br/></div><div>
<span style="font-style: normal; font-variant-caps: normal; font-stretch: normal; line-height: normal; font-family: &quot;.PingFang SC&quot;; color: rgb(20, 23, 28);"><b><font style="font-size: 18px;">优化圈选功能，定接口，补充根据配置文件采集数据及本地存储、上传策略</font></b></span></div><div><br/></div><div><br/></div><div>上传事件格式：</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>2019-03-07 18:04:13.928 11050-11050/com.antourong.itouzi E/马东强:</div><div>viewClickEvent:UserBehaviorEvent{</div><div>    userHashId='6462129’,        </div><div> viewId='com.antourong.itouzi.MainActivity.DecorView[0].LinearLayout[0].FrameLayout[1].FitWindowsLinearLayout[0].ContentFrameLayout[1].RelativeLayout[2].DrawerLayout[0].FrameLayout[0].FrameLayout[0].RelativeLayout[0].LinearLayout[0].MaterialRefreshLayout[1].HomeScrollView[1].LinearLayout[0].FrameLayout[4].LinearLayout[0].LinearLayout[2].AppCompatImageView[0]’, </div><div>    view=android.support.v7.widget.AppCompatImageView{b1fe0f2 V.ED..... ........ 56,0-214,158 #7f1005ca app:id/image_discovery_common}, </div><div>    pageName='MainActivity’, </div><div>    timeMillis=1551953053913, </div><div>    eventType=1</div><div>}</div><div><br/></div><div>pageLifeCycleEvent:PageLifeCycleEvent{userHashId='6462129', timeMillis=1551953054317, eventType=4, pageName='com.antourong.itouzi.activity.MainActivity'}</div></div><div><span style="font-size: 18px;"><br/></span></div><div><span style="font-size: 18px;">流程定制：</span></div><ol><li><div><span style="font-size: 18px;">默认采集所有事件并全部上传</span></div></li><li><div><span style="font-size: 18px;">通过开发者功能圈选，可以指定要采集事件的 View，没有圈选的 View 不采集</span></div></li><li><div><span style="font-size: 18px;">如果通过圈选选定了 view，则通过接口加载圈选的 View id，只采集圈选的 View 事件</span></div></li></ol><div><span style="font-size: 18px;"><br/></span></div><div><span style="font-size: 18px;"><br/></span></div><div><span style="font-size: 18px;">后续需要一个采集页面按钮 id 的功能</span></div><div><span style="font-size: 18px;">做完采集控件 id 的功能之后，就可以根据设置的配置文件，来管理采集哪些数据了</span></div><div><span style="font-size: 18px;"><br/></span></div><div><span style="font-size: 18px; font-weight: bold;">一、索引</span></div><div>目前成型的埋点方案有三种：</div><ol><li><div>代码埋点</div></li><li><div>无埋点，也叫无痕埋点或全埋点</div></li><li><div>可视化埋点</div></li></ol><div><br/></div><div><span style="font-size: 18px; font-weight: bold;">二、概述</span></div><div><span style="font-size: 14px; font-weight: bold;">一、代码埋点</span></div><div>所谓代码埋点，是指在每一处需要进行数据采集的业务逻辑点，专门插入数据采集代码，然后在指定事件发生时，记录事件，并按照一定策略调用数据上传接口上报数据。</div><div>
<span style="font-size: 14px;"><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: bold; line-height: normal;">优点：</span></span></div><ol><li><div>
 <span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">控制精准</span></div></li><li><div><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(2, 2, 2); font-family: &quot;.PingFang SC&quot;;">在收集个性化数据时也比较灵活</span></div></li></ol><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"
/></div><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: bold; line-height: normal;"
/><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: bold; line-height: normal;">缺点：</span></div><ol><li><div>
 <span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">新增埋点依赖</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">App</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">发版，影响数据收集时机。</span></div></li><li><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; line-height: normal;">新增埋点依赖开发</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">，增加了开发测试的工作量，影响版本进度。</span></div></li><li><div><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(2, 2, 2); font-family: &quot;.PingFang SC&quot;;">业务侵入性强，埋点代码和业务代码耦合在一起，增加代码维护难度。</span></div></li><li><div><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(2, 2, 2); font-family: &quot;.PingFang SC&quot;;">如果埋点错误只能更新版本解决</span></div></li><li><div><span style="font-size: 14px; --inversion-type-color:  simple; color: rgb(2, 2, 2); font-family: &quot;.PingFang SC&quot;;">不能通过接口动态管理埋点位置</span></div></li></ol><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: bold; line-height: normal;">二、全埋点</span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">所谓全埋点，是指将 APP 内产生的所有的满足某种条件的行为事件全部记录下来，</span><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2);">并按照一定策略调用数据上传接口上报数据。</span></div><div><span style="caret-color: rgb(253, 253, 253);"><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2); font-weight: bold;">优点：</span></span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">自动记录满足埋点条件的所有记录，新增埋点不依赖开发</span></div></li><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">全埋点一般采用 AOP 或者是方法替换的方式实现，埋点逻辑不侵入业务</span></div></li></ol><div><span style="caret-color: rgb(253, 253, 253);"><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2); font-weight: bold;">缺点：</span></span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">上报数据量很大，里面有很多数据是没有价值的，也造成服务器压力很大</span></div></li><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">不方便后续分析</span></div></li></ol><div><br/></div><div><br/></div><div><span style="font-size: 14px; font-weight: bold;">三、可视化埋点</span></div><div>所谓可视化埋点，是指通过可视化工具配置要进行埋点的节点，在 APP 打开时，加载配置信息，根据配置文件采集指定节点产生的事件，<span style="--inversion-type-color:  simple; color: rgb(2, 2, 2);">并按照一定策略调用数据上传接口上报数据，GrowingIO 即采用的这种方式；可视化埋点是按需配置埋点方案。</span></div><div><span style="caret-color: rgb(253, 253, 253);"><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2); font-weight: bold;">优点：</span></span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">按需埋点</span></div></li><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">可以通过圈选等操作动态管理埋点，非常灵活</span></div></li></ol><div><span style="caret-color: rgb(253, 253, 253);"><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2); font-weight: bold;">缺点：</span></span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">开发量很大</span></div></li><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">版本迭代、布局变更比较难确认唯一 ID</span></div></li></ol><div><br/></div><div><span style="--inversion-type-color:  simple; font-size: 18px; color: rgb(2, 2, 2); font-weight: bold;">三、埋点技术方案整理</span></div><div><span style="--inversion-type-color:  simple; font-size: 14px; color: rgb(2, 2, 2); font-weight: bold;">一、代码埋点</span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">按需在指定位置添加埋点逻辑即可，将数据存储、上传等逻辑简单封装，在指定需要埋点处添加少量代码即可</span></div><div><br/></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple;"><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2); font-weight: bold;">二、全埋点</span></span></div><div>
<span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">全埋点要对方法进行</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Hook</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">，按照是否在运行时这个条件来区分，</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Android</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">全埋点可以有下面两种方式：</span></div><ol><li><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">静态</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; line-height: normal;">Hook</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">：</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; line-height: normal;">AspectJ</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">实现</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; line-height: normal;">AOP</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">，编译期修改代码</span></div></li><li><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">动态</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; line-height: normal;">Hook</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">：运行时替换</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; line-height: normal;">View.OnClickListener</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; line-height: normal;">等需要埋点的事件回调</span></div></li></ol><div><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"
/><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">这里的</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Hook</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">其实就是一种</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">AOP</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">实现。</span></div><div><span style="font-size: 14px;"><br/></span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">使用 AspectJ 实现静态Hook：编译期织入代码，效率较高，可能的示例如下所示，</span>
<span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">这段</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Aspect</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">的代码定义了：在执行</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">android.view.View.OnClickListener.onClick</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">android.view.View</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)方法原有的实现后面，需要插入</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">AopUtil.sendTrackEventToSDK</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">joinPoint</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">,</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> "onViewOnClick”</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)；</span></div></li></ol><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">           AspectJ 在 Android 端的使用待进一步调研，在此不进一步体现。</span></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>import org.aspectj.lang.JoinPoint;</div><div>import org.aspectj.lang.annotation.After;</div><div>import org.aspectj.lang.annotation.Aspect;</div><div>import org.aspectj.lang.annotation.Pointcut;</div><div>@Aspect</div><div>public class ViewOnClickListenerAspectj {</div><div>    /**</div><div>      * android.view.View.OnClickListener.onClick(android.view.View)</div><div>      * @param joinPoint JoinPoint</div><div>      * @throws Throwable Exception</div><div>      */</div><div>    @After("execution(* android.view.View.OnClickListener.onClick(android.view.View))")</div><div>    public void onViewClickAOP(final JoinPoint joinPoint) throws Throwable {</div><div>        AopUtil.sendTrackEvent(joinPoint, "onViewOnClick");</div><div>    }</div><div>}</div></div><div><br/></div><ol start="2"><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">使用动态代理实现动态Hook：运行时动态代理，伴随有大量反射调用，对性能影响较大；要代理所有 View 的 click 事件，需要遍历 View 树，也很消耗性能；</span></div></li></ol><div><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2);">           通过动态代理主要代理的是 </span><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; overflow-wrap: break-word; background-color: rgb(238, 238, 238); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; color: rgb(85, 85, 85); font-family: consolas, Menlo, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">mListenerInfo.mOnClickListener </span><span style="font-size: 13px; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; overflow-wrap: break-word; background-color: rgb(238, 238, 238); border-top-left-radius: 3px; border-top-right-radius: 3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px; color: rgb(85, 85, 85); font-family: consolas, Menlo, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, monospace; font-variant-caps: normal; font-variant-ligatures: normal;">对象，本对象存储着 View 的点击事件</span><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2);"> ，可能的示例如下所示：</span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">           待进一步调研</span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">        </span></div><div><span style="caret-color: rgb(253, 253, 253);"><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>// ===== 首先定义代理监听器=====</div><div>// 点击监听器的代理类，具有上报点击行为的功能</div><div>class OnClickListenerWrapper implements View.OnClickListener {</div><div>    // 原始的点击监听器对象</div><div>    private View.OnClickListener onClickListener;</div><div>    public OnClickListenerWrapper(View.OnClickListener onClickListener) {</div><div>        this.onClickListener = onClickListener;</div><div>    }</div><div>    @Override</div><div>    public void onClick(View view) {</div><div>        // 让原来的点击监听器正常工作</div><div>        if(onClickListener != null){</div><div>            onClickListener.onClick(view);</div><div>        }</div><div>        // 点击事件上报，可以获取被点击view的一些属性</div><div>        track(APP_CLICK_EVENT_NAME, getSomeProperties(view));</div><div>    }</div><div>}</div><div><br/></div><div><br/></div><div><br/></div><div>// ==== 其次反射获取一个View的mListenerInfo.mOnClickListener，替换成代理的点击监听器 ====</div><div>// 对一个View的点击监听器进行hook</div><div>public void hookView(View view) {</div><div>    // 1. 反射调用View的getListenerInfo方法（API&gt;=14），获得mListenerInfo对象</div><div>    Class viewClazz = Class.forName("android.view.View");</div><div>    Method getListenerInfoMethod = viewClazz.getDeclaredMethod("getListenerInfo");</div><div>    if (!getListenerInfoMethod.isAccessible()) {</div><div>        getListenerInfoMethod.setAccessible(true);</div><div>    }</div><div>    Object mListenerInfo = listenerInfoMethod.invoke(view);</div><div>    // 2. 然后从mListenerInfo中反射获取mOnClickListener对象</div><div>    Class listenerInfoClazz = Class.forName("android.view.View$ListenerInfo");</div><div>    Field onClickListenerField = listenerInfoClazz.getDeclaredField("mOnClickListener");</div><div>    if (!onClickListenerField.isAccessible()) {</div><div>        onClickListenerField.setAccessible(true);</div><div>    }</div><div>    View.OnClickListener mOnClickListener = (View.OnClickListener) onClickListenerField.get(mListenerInfo);</div><div>    // 3. 创建代理的点击监听器对象</div><div>    View.OnClickListener mOnClickListenerWrapper = new OnClickListenerWrapper(mOnClickListener);</div><div>    // 4. 把mListenerInfo的mOnClickListener设成新的onClickListenerWrapper</div><div>    onClickListenerField.set(mListenerInfo, mOnClickListenerWrapper);</div><div>    // 用这个似乎也可以：view.setOnClickListener(mOnClickListenerWrapper);</div><div>}</div><div><br/></div><div>// ==== 最后，遍历当前页面 View 树，给所有的 View 添加代理</div></div></span></div><div><br/></div><div><span style="caret-color: rgb(253, 253, 253);"><span style="--inversion-type-color:  simple; color: rgb(2, 2, 2); font-weight: bold;">三、可视化埋点</span></span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">可视化埋点分为两步：</span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">首先，是通过可视化工具，配置要采集数据的 View</span></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">其次，APP 加载配置并解析，找到指定 View，Hook 它的事件并上报</span></div><div><br/></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">其中 Hook View 部分技术方案和全埋点基本基本相同，下面简单说一下可视化采集配置信息的技术方案</span></div><div><br/></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">可视化采集配置信息有两种方式：</span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">通过 WebSocket 使用 Web 后台完成圈选：和后台建立 WebSocket 连接之后，对手机屏幕截图，并从 DecorView 遍历当前页面 View 树，记录如下信息：</span></div></li></ol><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;"><div>{</div><div>    "type": "snapshot_response",</div><div>    "payload": {</div><div>        "activities": [</div><div>            "activity": "com.sensorsdata.analytics.android.demo.MainActivity",</div><div>            "scale": 0.3809524,</div><div>            "serialized_objects": {</div><div>                "rootObject": 88528516,</div><div>                "objects": [</div><div>                    {</div><div>                        "hashCode": 88528516,</div><div>                        "id": -1,</div><div>                        "index": -1,</div><div>                        "sa_id_name": null,</div><div>                        "top": 0,</div><div>                        "left": 0,</div><div>                        "width": 1080,</div><div>                        "height": 1920,</div><div>                        "scrollX": 0,</div><div>                        "scrollY": 0,</div><div>                        "visibility": 0,</div><div>                        "translationX": 0,</div><div>                        "translationY": 0,</div><div>                        "classes": [</div><div>                            "com.android.internal.policy.DecorView",</div><div>                            "android.widget.FrameLayout",</div><div>                            "android.view.ViewGroup",</div><div>                            "android.view.View"</div><div>                        ],</div><div>                        "subviews": [</div><div>                            57495077,</div><div>                            150453242</div><div>                        ]</div><div>                    }</div><div>                ]</div><div>            },</div><div>            "image_hash": "785C4DC3B01B4AFA56BA0E3A56CE8657",</div><div>            "screenshot": “屏幕截图的base64编码"</div><div>        ],</div><div>        "snapshot_time_millis": 403</div><div>    }</div><div>}</div></div><div>
<span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">将上面收集到数据发送到连接的</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">WebSocket</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">后台，由后台解析之后，可以把</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">App</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">界面的截图展示在</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Web</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">页面。然后把可以监测的元素以方框的形式添加在界面上提示用户（</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">web</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">页面实现时，我推测只需要用到这个</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">View</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">的</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">left</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">、</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">top</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">、</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">width</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">、</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">height</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">属性在</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">html</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">上加一个</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">div</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">标签，然后设置一个有颜色的</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">border</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">属性即可）。用户可以在这个</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Web</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">页面点击需要监测的元素，设置这个元素的事件名称（</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">event_type</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">和</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">event_name</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">），点击保存。保存一个需要监测的元素时，需要保存这个元素在当前</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Activity</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">的</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">ViewTree</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">的路径</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">path</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">，以及这个</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">View</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;.PingFang SC&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">在父控件中的</span><span style="font-size: 14px; color: rgb(20, 23, 28); font-family: &quot;Helvetica Neue&quot;; font-stretch: normal; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">index等保持View唯一性的信息，以及要采集的事件信息等</span></div><ol start="2"><li><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple; color: rgb(2, 2, 2);">直接通过圈选工具，在移动端完成圈选(类似 GrowingIO)：可行的一种实现方案是获取圈选点当前坐标，然后遍历 View 树，看圈选点坐标在哪个 View 或 ViewGroup 范围内，然后记录该 View 的唯一性信息以及要采集的事件信息</span></div></li></ol><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 18px; font-weight: bold;">四、View ID 的确定及版本迭代-参考笑璇整理的方案，思路基本一致</span></div><div><font style="font-size: 18px;"><br/></font></div><div><span style="font-size: 18px; font-weight: bold;">五、总结</span></div><table style="border-collapse: collapse; min-width: 100%;"><colgroup><col style="width: 122px;"/><col style="width: 319px;"/><col style="width: 450px;"/><col style="width: 328px;"/></colgroup><tbody><tr><td style="text-align: center; vertical-align: middle; width: 122px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 700;">埋点方案</span></div></td><td style="text-align: left; vertical-align: middle; width: 319px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 700;">优点</span></div></td><td style="text-align: left; vertical-align: middle; width: 450px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 700;">缺点</span></div></td><td style="text-align: left; vertical-align: middle; width: 328px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: 700;">适用场景</span></div></td></tr><tr style="background-color: rgb(249, 249, 249);"><td style="text-align: center; vertical-align: middle; width: 122px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">代码埋点 </span></div></td><td style="text-align: left; vertical-align: middle; width: 319px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">1.使用灵活，精确控制发送时机 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">2.方便设置自定义业务相关的属性 </span></div></td><td style="text-align: left; vertical-align: middle; width: 450px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">1.埋点成本高，工作量大，必须是技术人员才能完成 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">2.更新成本高，一旦上线很难修改。只能通过热修复或者重新发版 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">3.对业务代码的侵入大 </span></div></td><td style="text-align: left; vertical-align: middle; width: 328px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">对业务上下文理解要求较高的业务数据，如电商购物这类可能经过多次页面跳转，埋点时还需要带上前面页面中的一些信息 </span></div></td></tr><tr><td style="text-align: center; vertical-align: middle; width: 122px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">全埋点 </span></div></td><td style="text-align: left; vertical-align: middle; width: 319px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">1.开发、维护成本低 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">2.可以追溯历史数据 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">3.对业务代码侵入小 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">4.可以收集到一些额外信息，例如界面的热力图 </span></div></td><td style="text-align: left; vertical-align: middle; width: 450px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">1.高额流量和计算成本 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">2.无法灵活收集属性 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">3.动态的Hook方式支持的控件有限、事件类型有限，大量事件监测时反射对App运行性能有影响 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">4.静态的Hook方式需要第三方编译器参与，打包时间增长 </span></div></td><td style="text-align: left; vertical-align: middle; width: 328px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">上下文相对独立的、通用的数据，如点击热力图，性能监控和日志 </span></div></td></tr><tr style="background-color: rgb(245, 245, 245);"><td style="text-align: center; vertical-align: middle; width: 122px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">可视化埋点 </span></div></td><td style="text-align: left; vertical-align: middle; width: 319px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">1.可以按需埋点，灵活性好 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">2.对业务代码侵入小 </span></div></td><td style="text-align: left; vertical-align: middle; width: 450px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">1.界面的结构发生变化时，圈选的待监测元素可能会失效 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">2.支持的控件和事件类型有限 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">3.无法灵活地收集到上下文属性 </span></div><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">4.开发量相对较大</span></div></td><td style="text-align: left; vertical-align: middle; width: 328px; padding: 8px; border: 1px solid;"><div style="background-color: rgba(255, 255, 255, 0.901961); font-size: 14px;"><span style="font-size: 14px; color: rgb(85, 85, 85); font-family: Lato, &quot;PT Serif&quot;, &quot;Microsoft YaHei&quot;, sans-serif; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: normal;">上下文相对简单，依靠控件可以获得上下文信息，界面结构比较简单固定，如新闻阅读、游戏分享界面 </span></div></td></tr></tbody></table><div><br/></div><div><br/></div><div><span style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple;"><span style="--inversion-type-color:  simple; font-size: 18px; color: rgb(2, 2, 2); font-weight: bold;">参考：</span></span></div><ol><li><div><span style="caret-color: rgb(253, 253, 253);"><a href="http://unclechen.github.io/2017/12/18/Android%E5%9F%8B%E7%82%B9%E6%8A%80%E6%9C%AF%E5%88%86%E6%9E%90/" style="--inversion-type-color:  simple;">无埋点方案解析</a></span></div></li><li><div><a href="https://www.jianshu.com/p/b5ffe845fe2d">View ID 生成规则</a></div></li><li><div><a href="https://github.com/sensorsdata/sa-sdk-android" style="caret-color: rgb(253, 253, 253); --inversion-type-color:  simple;">神策SDK</a><span style="caret-color: rgb(253, 253, 253);">：可直接配置后台 URL，但是上传数据格式及后台怎么存储，需要去源码里面找</span></div></li><li><div>如果需要 Gradle 插件，可以参考 <a href="https://github.com/HujiangTechnology/gradle_plugin_android_aspectjx">沪江开源插件</a></div></li><li><div>网易 <a href="https://neyoufan.github.io/2017/07/11/android/%E7%BD%91%E6%98%93HubbleData%E4%B9%8BAndroid%E6%97%A0%E5%9F%8B%E7%82%B9%E5%AE%9E%E8%B7%B5/">HubbleData</a></div></li><li><div><a href="https://mp.weixin.qq.com/s/P95ATtgT2pgx4bSLCAzi3Q">51CTO 方案</a></div></li><li><div><a href="https://blog.csdn.net/xwh_1230/article/details/78225258">AspectJ 入门使用</a></div></li><li><div><a href="https://blog.csdn.net/innost/article/details/49387395">深入理解 Android AOP</a></div></li></ol><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><span style="font-size: 14px;"><br/></span></div><div><br/></div></body></html>